---
title: "Data analysis plan"
author: "NICE"
date: "`r Sys.Date()`"
output: 
    html_document:
        toc: true
        toc_float: true
        collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Tips for use

Check decisions with requestor or other analysts throughout.

Update the document as you go along with the analysis. Document when decisions, definitions and assumptions change and why. Use git to ensure there is an audit trail.


# Who

## Project sponsor

Who is requesting this data?

## Users/audience

Who will be using the output?

## Other stakeholders

Any other stakeholders who have an interest in the project and what influence they have.


# Project brief 

## Why: Analysis question

What question do we need to answer?

### Relevant guidance

Link to guidance.

Paste relevant recommendations for reference.

### Time period

What time period is of interest?

Any influential dates/periods which should be noted? (e.g. date guidance published, COVID-19)

### Target population

What population will this data be applied to?

### Rationale

Why is this question being asked?

What is the business need?

### Context

### Use

How will the data be used?

Who will use the data? e.g. committee

What is the risk level of this project? (Determines QA needs. If data is being used to inform NICE guidance, this is at least a medium-high business risk and would require QA.)


# When

Timelines, deadlines, milestones


# Data source

Relevant data items:

Population covered:

Time period covered:

## Restrictions around data usage

### Data usage

Where will the data be stored?

What is the retention period? 

### Publishing

Is the data going to be published by NICE?

What needs to done if this data is included in a published document?

e.g. required text citing the data source (SDE and CPRD), sending the publication to the data owner (CPRD), referencing approved protocol number (CPRD)

### Known issues

Known issues which will affect query.

# Approvals and authorizations

## Data owner

Does a research application need to be submitted to the data owner?

Status:

Protocol number:

## NICE internal processes

Does an internal research application need to be submitted?


# Background metrics

You may want to define some background metrics to understand the desired metrics.

Sample size: e.g. number of women in HES APC with a breast cancer diagnosis code in 2018-19

e.g. if looking at what proportion of people with CKD have an eGFR less than 15, you may first want to know what proportion of people with CKD have had an eGFR measurement in the last year.

# Metric 1

## Numerator

Time period:

Case definition: Reference code lists

## Denominator

Cohort:

Time period:

Inclusion and exclusion criteria: Reference code lists

## Subgroup analyses

What subgroup analyses will be done for this metric? e.g. deprivation, age groups, gender, ethnicity?

What categories will be used for these factors?


# Metric 2

Copy headings for Metric 1


# Code lists


# Data cleaning and checks

## Completeness: Missing data

Assess missingness of each variable.

Remove empty columns.

## Uniqueness

Remove duplicate rows.

## Distribution of each variable

Check the distribution of each variable.

For continuous variables:  
- Look at the summary stats: min, Q1, mean, median, Q3, max.
- Plot in a histogram.

Are the values as expected for this population?

Use tables for categorical variables, showing number and proportion. Can plot as histogram if desired.

## Accuracy: Improbable values or groups

For measurements, e.g. eGFR, cholesterol or blood pressure, may need to filter out negative values as you would never get a negative reading. May also want to consult with requestor or clinician and set an upper threshold, above which is not humanly possible to have such a value.

## Consistency

### Data types

### Categories 

### Converting units

For measurements, what is the standard unit used? What other units are used and how do you convert to standard units?

### Consistent columns across data tables

If joining two tables and same data item in each table (e.g. year of birth), are these consistent?

# Analysis method

Descriptive? Summarise central tendency (mean, median, mode) and spread (quantiles, range, min, max)

## Statistical disclosure control

What steps will be taken to minimise disclosure risks?

# Expected output

Format, e.g. report, dashboard, spreadsheet  
Graphs, maps, infographics

# Compare with existing data

Any audit or study data to compare your results with?

# QA plan

## Version control

GitHub repo link

## Code verification and validation

Validation checks whether the right model has been built (ie. does this analytical approach answer the question?). Verification checks if the model has been built right (ie. does the code work as intended?).

# Limitations

Key assumptions

Factors influencing uncertainty

Possible implications

Population not captured
